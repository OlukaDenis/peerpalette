{% extends "_base.html" %}
{% block headtags %}
<script type='text/javascript' src='/static/autoresize.jquery.js'></script>
<script type="text/javascript">
$(document).ready(function() {
  $("#searchbox").focus();
  $("#random").click(function() {
    random_chat_start(true);
    return false;
  });
  $("#context").autoResize({extraSpace: 0, limit : 80});
  $("#context").trigger("change");
});

function context_edit() {
  c = $("#context[readonly]");
  if (c.length == 0)
    return;
  context_text = $("#context").val();
  $("#context-buttons").show();
  c.removeAttr('readonly');
  c.removeClass('context-view').addClass('context-edit');
  c.select();
}

function context_cancel() {
  $("#context").val(context_text);
  $("#context").trigger("change");
  $("#context-buttons").hide();
  $("#context").attr('readonly','readonly');
  $('#context').removeClass('context-edit').addClass('context-view');
}

function context_save() {
  var text = $('#context').val();
  if (text == context_text) {
    context_cancel();
    return;
  }
  $.ajax({
    url: "/updatecontext",
    type: "POST",
    data: ({context : text}),
    success: function(msg) {
      $("#context").val(msg);
      $("#context").trigger("change");
      $("#context-buttons").hide();
      $("#context").attr('readonly','readonly');
      $('#context').removeClass('context-edit').addClass('context-view');
    },
    error: function(arg1, arg2, arg3) {
      alert("Couldn't update your context. Please try refreshing the page.");
    }
  });
}
</script>
{% endblock headtags %}
{% block content %}
<div id="content" style="padding: 10px;font-family:sans-serif;color:#444444;">
  <div>
Peerpalette is a new way for one-on-one chat with strangers. Search by topic or let us pick someone at random for you.
  <div>
  <div style="text-align:center;margin-top:30px;">
  {% include "_search.html" %}
  </div>
  <div style="text-align:center;margin:5px;color:#777">
    or
  </div>
  <div style="text-align:center;">
    <a id="random" href="/random" class="button blue" style="padding-top: .8em; padding-bottom: .8em;">Random Chat</a>
  </div>
  <div style="margin-top: 10px;">
    <span style="font-size: 14px; font-weight: bold;">What are you up to?</span>
    <div><textarea id="context" style="width:100%;height: 1em;" class="context-view" readonly=true onkeypress="context_edit();" onclick="context_edit();">{{context|escape}}</textarea></div>
    <div style="height: 20px;">
      <div id="context-buttons" style="display:none;">
        <a href="#" onclick="context_cancel();return false;" style="font-size:10px;">Cancel</a>
        <a href="#" onclick="context_save();return false;" style="font-size:10px;">Save</a>
      </div>
    </div>
  </div>
{% if recent_searches %}
  <div>
    <span style="font-size: 14px; font-weight: bold;">Hot searches</span>
    <br/>
    {% for t in recent_searches %}
      <a href="/search?q={{t.query_string|urlencode}}" style="margin-right:0.5em;">{{t.query_string|escape}}</a>
    {% endfor %}
  </div>
  {% if conversations %}
  <div>
    <br/>
    <b>New messages:</b>
    <br/>
    {% for conversation in conversations %}
    <div>
      <div><b><a href="/chat/{{conversation.name}}" class="{{conversation.status_class}}">{{conversation.username}}</a></b><span style="color:#888;"> &mdash; {{conversation.title|escape}}</span></div>
    </div>
    {% endfor %}
  </div>
  {% endif %}
</div>
{% endif %}
{% endblock content%}

