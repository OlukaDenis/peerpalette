{% extends "_base.html" %}
{% block headtags %}
<script type='text/javascript' src='/static/autoresize.jquery.js'></script>
<script type="text/javascript">
$(document).ready(function() {
  $("#searchbox").focus();
  $("#random_form").submit(function() {
    random_chat_start(true);
    return false;
  });
  $("#context").autoResize({extraSpace: 0});
  $("#context").trigger("change");
});

function context_edit() {
  c = $("#context[readonly]");
  if (c.length == 0)
    return;
  context_text = $("#context").val();
  $("#context-buttons").show();
  c.removeAttr('readonly');
  c.removeClass('context-view').addClass('context-edit');
  c.select();
}

function context_cancel() {
  $("#context").val(context_text);
  $("#context").trigger("change");
  $("#context-buttons").hide();
  $("#context").attr('readonly','readonly');
  $('#context').removeClass('context-edit').addClass('context-view');
}

function context_save() {
  var text = $('#context').val();
  if (text == context_text) {
    context_cancel();
    return;
  }
  $.ajax({
    url: "/updatecontext",
    type: "POST",
    data: ({context : text}),
    success: function(msg) {
      $("#context").val(msg);
      $("#context").trigger("change");
      $("#context-buttons").hide();
      $("#context").attr('readonly','readonly');
      $('#context').removeClass('context-edit').addClass('context-view');
    },
    error: function(arg1, arg2, arg3) {
      alert("Couldn't update your context. Please try refreshing the page.");
    }
  });
}
</script>
{% endblock headtags %}
{% block content %}
<div id="content" style="padding: 10px;font-family:sans-serif;color:#444444;">
  <p>
    Peerpalette is a new way to chat with other citizens of the Internet anonymously about topics that matter to you. Simply enter your search query to start chatting with interesting people. There are <b>{{num_online_users}} interesting people online right now</b>.
  </p>
  <div style="text-align:center;margin-top:50px;">
  {% include "_search.html" %}
  </div>
  <div style="text-align:center;margin:5px;color:#777">
    or
  </div>
  <div style="text-align:center;">
    <form id="random_form" action="/random" method="get">
    <input id="random_button" type="submit" value="Random Chat" style="padding:10px;font-size:16px;"/>
    </form>
  </div>
  <div style="margin-bottom: 10px;">
    <b>Present yourself:</b>
    <div><textarea id="context" style="width:100%;height:1em;" class="context-view" readonly=true onkeypress="context_edit();" onclick="context_edit();">{{context|escape}}</textarea></div>
    <div id="context-buttons" style="display:none;">
      <a href="#" onclick="context_cancel();return false;" style="font-size:10px;">Cancel</a>
      <a href="#" onclick="context_save();return false;" style="font-size:10px;">Save</a>
    </div>
  </div>
  <div>
    <b>Suggested topics:</b>
    <br/>
    {% for t in topics %}
      <a href="/search?q={{t|urlencode}}" style="margin-right:0.5em;">{{t|escape}}</a>
    {% endfor %}
  </div>
  {% if conversations %}
  <div>
    <br/>
    <b>New messages:</b>
    <br/>
    {% for conversation in conversations %}
    <div style="clear:left">
      <div style="float:left;margin-right:0.5em;"><b><a href="/chat/{{conversation.key_name}}" class="{{conversation.status_class}}">{{conversation.title|escape}}</a></b></div>
    {% if conversation.excerpt %}<span class="excerpt">{{conversation.excerpt|escape}}</span>{% endif %}
    </div>
    {% endfor %}
  </div>
  {% endif %}
</div>
<div style="text-align:center;margin:10px 0px;">

<a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.peerpalette.com" data-text="Ask and discuss things with strangers anonymously. #peerpalette" data-count="horizontal" data-via="zaidabdulla">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>

</div>
{% endblock content%}

